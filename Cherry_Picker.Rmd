---
title: "Cherry_Picker"
author: "Gianluca Pegoraro"
date: "November 15, 2016"
output: html_document
---
## Aim

```{r loadAndClean}
library(plyr)
library(ggplot2)
library(data.table)
library(stringr)
library(knitr)
```

```{r, include=FALSE, warning=FALSE}
opts_chunk$set(fig.path="output/", cache = TRUE, dev=c("png"), message=FALSE, warning=FALSE)
theme_set(theme_minimal())
```

## Import Data

Generate some test data (Full source plate). 
```{r}
set.seed(161115)

template <- data.table(source_rack = rep(paste0("HTIF000", 1:4), each = 96),
                    source_pos = rep(1:96, 4),
                    source_col = rep(1:12, each = 8),
                    source_row = rep(1:8, 12),
                    dest_rack = rep(paste0("HTIF000", 5:8), each = 96),
                    dest_pos = rep(1:96, 4),
                    dest_col = rep(1:12, each = 8),
                    dest_row = rep(1:8, 12))

input <- data.table(source_rack = rep(paste0("HTIF000", 1:4), each = 96),
                    source_id =  paste0("ID_", sample(1:1000, 384)),
                    source_pos = rep(1:96, 4),
                    source_col = rep(1:12, each = 8),
                    source_row = rep(1:8, 12),
                    source_flag = sample(c("Hit", "Miss"), 384, replace = TRUE, prob = c(0.35, 0.65)))
```

Randomize empty wells in the Source plates (`Miss`)
```{r}
input[source_flag == "Miss", source_id := NA]
```

Plot the Source plates layout
```{r}
input_plot <- ggplot(input, aes(x = source_col, y = source_row, label = source_id))
input_plot + geom_text(size = 1.5) +
            facet_wrap( ~ source_rack) +
            scale_x_continuous(breaks = 1:12) +
            ylim(LETTERS[8:1]) +
            ggtitle("Source Plates Layout")
```

Filter out empty wells
```{r}
input_fil <- input[source_flag == "Hit",]
```

Assign the destination positions
```{r}
input_fil[, `:=`(dest_rack = rep(paste0("HTIF000", 5:8), each = 96),
                 dest_pos = 1:96,
                 dest_col = rep(1:12, each = 8),
                 dest_row = rep(1:8, 12))]
```

Plot the Source plates layout
```{r}
output_plot <- ggplot(input_fil, aes(x = dest_col, y = dest_row, label = source_id))
output_plot + geom_text(size = 1.5) +
            facet_wrap( ~ dest_rack) +
            scale_x_continuous(breaks = 1:12) +
            ylim(LETTERS[8:1]) +
            ggtitle("Dest Plates Layout")
```

Document the information about the analysis session
```{r sessionInfo, include=TRUE, echo=TRUE, results='markup'}
sessionInfo()
```